"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([["src_app_pages_excolonies_excolonies_module_ts"],{4064:(T,A,s)=>{s.r(A),s.d(A,{ExcoloniesPageModule:()=>S});var v=s(6362),_=s(587),o=s(3444),p=s(5513),O=s(4929),m=s(5670),t=s(6723),f=s(3235),l=s(5211),E=s(1903);function x(e,c){1&e&&t._UZ(0,"ion-icon",17)}function w(e,c){1&e&&t._UZ(0,"ion-icon",18)}function C(e,c){1&e&&t._UZ(0,"ion-icon",19)}function g(e,c){if(1&e){const i=t.EpF();t.TgZ(0,"ion-item"),t.YNc(1,x,1,0,"ion-icon",9),t.YNc(2,w,1,0,"ion-icon",10),t.YNc(3,C,1,0,"ion-icon",11),t.TgZ(4,"ion-label",12),t._uU(5),t.qZA(),t.TgZ(6,"ion-buttons",2)(7,"ion-button",13),t.NdJ("click",function(){const D=t.CHM(i).$implicit;return t.oxw(3).viewJournal(D)}),t._UZ(8,"ion-icon",14),t.qZA(),t.TgZ(9,"ion-button",15),t.NdJ("click",function(){const D=t.CHM(i).$implicit;return t.oxw(3).reactivate(D)}),t._UZ(10,"ion-icon",16),t.qZA()()()}if(2&e){const i=c.$implicit;t.xp6(1),t.Q6J("ngIf","DISSOLVED"===i.activityStatus),t.xp6(1),t.Q6J("ngIf","DECEASED"===i.activityStatus),t.xp6(1),t.Q6J("ngIf","SOLD"===i.activityStatus),t.xp6(2),t.Oqu(i.name)}}function I(e,c){if(1&e&&(t.ynx(0),t.YNc(1,g,11,4,"ion-item",8),t.BQk()),2&e){const i=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",i.colonies)}}function n(e,c){1&e&&(t.TgZ(0,"ion-item")(1,"ion-label",20),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&e&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"FORMER_COLONIES_PAGE.noColonies")))}function r(e,c){if(1&e&&(t.TgZ(0,"ion-list",5),t.YNc(1,I,2,1,"ng-container",6),t.YNc(2,n,4,3,"ng-template",null,7,t.W1O),t.qZA()),2&e){const i=t.MAs(3),h=t.oxw();t.Q6J("inset",!0),t.xp6(1),t.Q6J("ngIf",h.colonies.length>0)("ngIfElse",i)}}const d=[{path:"",component:(()=>{class e{constructor(i,h,y,D,P){this.swarmService=i,this.router=h,this.alertCtrl=y,this.translate=D,this.purchaseService=P}ionViewDidEnter(){this.swarmService.getFormerSwarms().pipe((0,m.P)()).subscribe(i=>{this.colonies=i})}reactivate(i){this.swarmService.getSwarms().pipe((0,m.P)()).subscribe(h=>(0,O.mG)(this,void 0,void 0,function*(){this.purchaseService.checkLimitReached(h?h.length:0)?yield(yield this.alertCtrl.create({header:this.translate.instant("COLONIES_PAGE.fullVersionRequiredDialogHeader"),message:this.translate.instant("COLONIES_PAGE.fullVersionRequiredDialogText"),buttons:[{text:this.translate.instant("GENERAL.ok"),cssClass:"secondary"}]})).present():yield(yield this.alertCtrl.create({header:this.translate.instant("FORMER_COLONIES_PAGE.reactivationHint"),buttons:[{text:this.translate.instant("GENERAL.cancel"),role:"cancel",cssClass:"secondary"},{text:this.translate.instant("GENERAL.yes"),handler:()=>this._onReactivate(i)}]})).present()}))}_onReactivate(i){this.swarmService.reactivate(i).pipe((0,m.P)()).subscribe(()=>{this.router.navigateByUrl("/")})}viewJournal(i){this.router.navigateByUrl(`/swarms/view/${i.id}/journal?readonly=1`)}}return e.\u0275fac=function(i){return new(i||e)(t.Y36(f.e),t.Y36(p.F0),t.Y36(o.Br),t.Y36(l.sK),t.Y36(E.B3))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-excolonies"]],decls:9,vars:5,consts:[[3,"translucent"],["color","primary"],["slot","end"],["menu","first"],[3,"inset",4,"ngIf"],[3,"inset"],[4,"ngIf","ngIfElse"],["noFormerColonies",""],[4,"ngFor","ngForOf"],["class","statusHint","slot","start","name","exit",4,"ngIf"],["class","statusHint","slot","start","name","heart-dislike",4,"ngIf"],["class","statusHint","slot","start","name","cash",4,"ngIf"],["slot","start"],[3,"click"],["name","book-outline"],["color","success",3,"click"],["name","fitness-outline"],["slot","start","name","exit",1,"statusHint"],["slot","start","name","heart-dislike",1,"statusHint"],["slot","start","name","cash",1,"statusHint"],[1,"ion-text-wrap"]],template:function(i,h){1&i&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),t._UZ(3,"ion-menu-button",3),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA()()(),t.TgZ(7,"ion-content"),t.YNc(8,r,4,3,"ion-list",4),t.qZA()),2&i&&(t.Q6J("translucent",!0),t.xp6(5),t.hij(" ",t.lcZ(6,3,"FORMER_COLONIES_PAGE.pageTitle")," "),t.xp6(3),t.Q6J("ngIf",h.colonies))},directives:[o.Gu,o.sr,o.Sm,o.fG,o.wd,o.W2,v.O5,o.q_,v.sg,o.Ie,o.gu,o.Q$,o.YG],pipes:[l.X$],styles:[".statusHint[_ngcontent-%COMP%]{color:#d3d3d3;width:20px}"]}),e})()}];let a=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[p.Bz.forChild(d)],p.Bz]}),e})(),S=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[v.ez,_.u5,o.Pc,a,l.aw]]}),e})()},3235:(T,A,s)=>{s.d(A,{e:()=>C});var v=s(4929),_=s(7589),o=s(1511),p=s(4858),O=s(4139),m=s(9095),t=s(3910),f=s(6942),l=(()=>{return(g=l||(l={})).ACTIVE="ACTIVE",g.DECEASED="DECEASED",g.SOLD="SOLD",g.DISSOLVED="DISSOLVED",l;var g})(),E=s(4512),x=s(6723),w=s(7503);let C=(()=>{class g{constructor(n,r,u){this.db=n,this.authService=r,this.storageSync=u}getSwarms(n=[l.SOLD,l.DECEASED,l.DISSOLVED]){return this.authService.getUser().pipe((0,m.w)(r=>(console.log("User",r.uid),(0,p.D)(this.storageSync.getFromStorage(E.F.SWARMS)).pipe((0,m.w)(u=>u?(0,O.of)(u).pipe((0,t.q)(1),(0,f.U)(d=>d.map(a=>Object.assign(Object.assign({},a),{created:new Date(a.created)})).filter(a=>-1===n.indexOf(a.activityStatus)))):(0,_.en)((0,o.iH)(this.db,`users/${r.uid}/swarms`),{keyField:"id"}).pipe((0,t.q)(1),(0,f.U)(d=>{const a=[];for(let S=0;S<d.length;S++){const e=d[S];a.push(Object.assign(Object.assign({},e),{created:new Date(e.created)}))}return this.writeSwarmsToStorage(a),a.filter(S=>-1===n.indexOf(S.activityStatus))})))))))}getSwarm(n){return(0,p.D)(this.storageSync.getFromStorage(E.F.SWARMS)).pipe((0,m.w)(r=>{const u=r?r.filter(d=>d.id===n)[0]:null;return u?(0,O.of)(u):this.authService.getUser().pipe((0,m.w)(d=>(0,_.FE)((0,o.iH)(this.db,`users/${d.uid}/swarms/${n}`),{keyField:"id"}).pipe((0,t.q)(1),(0,f.U)(a=>({id:n,name:a.name,created:new Date(a.created),activityStatus:a.activityStatus,ancestorId:a.ancestorId,isNucleus:a.isNucleus,about:a.about})))))}))}createSwarm(n,r=null,u=!1,d=""){return this.authService.getUser().pipe((0,m.w)(a=>(0,v.mG)(this,void 0,void 0,function*(){yield this._markStorageAsDirty();const S={name:n,created:(new Date).toISOString(),activityStatus:l.ACTIVE,ancestorId:r,isNucleus:u,about:d};return(0,o.VF)((0,o.iH)(this.db,`/users/${a.uid}/swarms`),S).then(e=>{const c=e._path.pieces_;return c[c.length-1]})})))}updateSwarm(n){return this.authService.getUser().pipe((0,f.U)(r=>(0,v.mG)(this,void 0,void 0,function*(){yield this._markStorageAsDirty(),(0,o.Vx)((0,o.iH)(this.db,`/users/${r.uid}/swarms/${n.id}`),n)})))}markAsDeceased(n){return this.deactivate(n,l.DECEASED)}markAsSold(n){return this.deactivate(n,l.SOLD)}markAsDissolved(n){return this.deactivate(n,l.DISSOLVED)}getFormerSwarms(){return this.getSwarms([l.ACTIVE])}reactivate(n){return this.authService.getUser().pipe((0,m.w)(r=>(0,v.mG)(this,void 0,void 0,function*(){return yield this._markStorageAsDirty(),(0,o.Vx)((0,o.iH)(this.db,`/users/${r.uid}/swarms/${n.id}`),{activityStatus:l.ACTIVE})})))}deactivate(n,r){return this.authService.getUser().pipe((0,m.w)(u=>(0,v.mG)(this,void 0,void 0,function*(){return yield this._markStorageAsDirty(),(0,o.Vx)((0,o.iH)(this.db,`/users/${u.uid}/swarms/${n.id}`),{activityStatus:r})})))}writeSwarmsToStorage(n){this.storageSync.writeToStorage(E.F.SWARMS,n.map(r=>{let u=null;try{u=new Date(r.created).toISOString()}catch(d){}return Object.assign(Object.assign({},r),{created:u})}))}_markStorageAsDirty(){return this.storageSync.clearStorage()}}return g.\u0275fac=function(n){return new(n||g)(x.LFG(_.vo),x.LFG(w.e),x.LFG(E.t))},g.\u0275prov=x.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"}),g})()}}]);
//# sourceMappingURL=src_app_pages_excolonies_excolonies_module_ts.c525d655207ee572.js.map