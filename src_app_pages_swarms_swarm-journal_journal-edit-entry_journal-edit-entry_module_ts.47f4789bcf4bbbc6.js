"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([["src_app_pages_swarms_swarm-journal_journal-edit-entry_journal-edit-entry_module_ts"],{5076:(x,p,a)=>{a.r(p),a.d(p,{JournalEditEntryPageModule:()=>C});var d=a(5211),u=a(6362),r=a(587),i=a(3444),c=a(5513),y=a(4929),g=a(1972),m=a(8079),t=a(6723),E=a(9896);const f=["actionSelect"];function A(n,s){if(1&n&&(t.TgZ(0,"ion-select-option",19),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n){const e=s.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(t.lcZ(2,2,"ACTIONS."+e))}}function v(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"ion-datetime",20,21),t.NdJ("ionChange",function(){t.CHM(e);const l=t.MAs(1);return t.oxw().setDate(l.value)}),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("value",e.initialDate)}}function J(n,s){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij("(",t.lcZ(2,1,"UNIT."+e.countable.unit),")")}}const Z=function(n){return{"ion-hide":n}},T=[{path:"",component:(()=>{class n{constructor(e,o,l,h,P,b){this.route=e,this.formBuilder=o,this.journalService=l,this.navCtrl=h,this.pickerController=P,this.translate=b,this.saving=!1}ngOnInit(){this.swarmId=this.route.snapshot.params.swarmId,this.entryId=this.route.snapshot.queryParams.entryId,this.type=this.route.snapshot.queryParams.type,this.typeOptions=this.type?m.Z[this.type]:Object.values(m.U),this.entryForm=this.formBuilder.group({actionType:new r.NI({value:null,disabled:!1},r.kI.required),date:[new Date,r.kI.required],amount:[0],text:[""]})}ionViewDidEnter(){this.entryId?this.journalService.getEntry(this.swarmId,this.entryId).subscribe(e=>{this.entryForm.controls.actionType.setValue(e.type?e.type.toString():null),this.entryForm.controls.text.setValue(e.text||""),this.entryForm.controls.amount.setValue(e.amount||""),e.date?(this.entryForm.controls.date.setValue(new Date(e.date)),this.initialDate=this.entryForm.controls.date.value.toISOString()):this.initialDate=(new Date).toISOString(),this.onActionTypeChange()}):(this.entryForm.controls.actionType.setValue(null),this.entryForm.controls.text.setValue(""),this.entryForm.controls.amount.setValue(""),this.entryForm.controls.date.setValue(new Date),this.initialDate=(new Date).toISOString())}save(){if(this.saving)return;this.saving=!0;const e={type:this.entryForm.get("actionType").value,date:this.entryForm.get("date").value,text:this.entryForm.get("text").value,amount:this.entryForm.get("amount").value};this.entryId?(e.id=this.entryId,this.journalService.updateEntry(this.swarmId,e).subscribe(this.onSuccessfullySaved.bind(this))):this.journalService.createEntry(this.swarmId,e).subscribe(this.onSuccessfullySaved.bind(this))}onSuccessfullySaved(){this.navCtrl.back()}ngAfterViewInit(){this.selectRef&&!this.entryId&&this.selectRef.open()}openAmountPicker(){return(0,y.mG)(this,void 0,void 0,function*(){yield(yield this.pickerController.create({columns:this.getAmountOptions(),buttons:[{text:this.translate.instant("GENERAL.cancel"),role:"cancel"},{text:this.translate.instant("GENERAL.ok"),handler:o=>{this.entryForm.controls.amount.setValue(+o.amount.value||0)}}]})).present()})}setDate(e){this.entryForm.controls.date.setValue(new Date("string"==typeof e?e:e[0]))}getAmountOptions(){const e=[];if(!this.countable)return e;for(let o=this.countable.lowerBound;o<=this.countable.upperBound;o+=this.countable.stepWidth)e.push({text:o+" "+this.translate.instant("UNIT."+(1===o?this.countable.unitSingular:this.countable.unit)),value:o});return[{name:"amount",options:e}]}onActionTypeChange(){this.countable=g.U.get(this.entryForm.controls.actionType.value)}onCancel(){this.navCtrl.back()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(c.gz),t.Y36(r.qu),t.Y36(E.N),t.Y36(i.SH),t.Y36(i.up),t.Y36(d.sK))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-journal-edit-entry"]],viewQuery:function(e,o){if(1&e&&t.Gf(f,5),2&e){let l;t.iGM(l=t.CRH())&&(o.selectRef=l.first)}},decls:45,vars:42,consts:[[3,"translucent"],["color","primary"],["slot","start"],[3,"routerLink"],["name","arrow-back-outline"],[3,"formGroup"],["mode","ios",3,"inset"],["position","stacked"],["name","actionType","interface","action-sheet","formControlName","actionType",3,"disabled","okText","cancelText","ionChange","ionCancel"],["actionSelect",""],[3,"value",4,"ngFor","ngForOf"],["id","date"],["trigger","date","size","cover"],[3,"ngClass"],[4,"ngIf"],["formControlName","amount","value","0",3,"click"],["formControlName","text",3,"placeholder"],[1,"controls-container"],["type","submit",1,"ion-padding-horizontal",3,"disabled","click"],[3,"value"],["presentation","date","locale","de-DE",3,"value","ionChange"],["popoverDate",""]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2)(3,"ion-button",3),t._UZ(4,"ion-icon",4),t.qZA()(),t.TgZ(5,"ion-title"),t._uU(6),t.ALo(7,"translate"),t.qZA()()(),t.TgZ(8,"ion-content")(9,"form",5)(10,"ion-list",6)(11,"ion-item")(12,"ion-label",7),t._uU(13),t.ALo(14,"translate"),t.qZA(),t.TgZ(15,"ion-select",8,9),t.NdJ("ionChange",function(){return o.onActionTypeChange()})("ionCancel",function(){return o.onCancel()}),t.ALo(17,"translate"),t.ALo(18,"translate"),t.YNc(19,A,3,4,"ion-select-option",10),t.qZA()(),t.TgZ(20,"ion-item")(21,"ion-label",7),t._uU(22),t.ALo(23,"translate"),t.qZA(),t.TgZ(24,"ion-input",11),t._uU(25),t.ALo(26,"date"),t.qZA(),t.TgZ(27,"ion-popover",12),t.YNc(28,v,2,1,"ng-template"),t.qZA()(),t.TgZ(29,"ion-item",13)(30,"ion-label",7),t._uU(31),t.ALo(32,"translate"),t.YNc(33,J,3,3,"span",14),t.qZA(),t.TgZ(34,"ion-input",15),t.NdJ("click",function(){return o.openAmountPicker()}),t.qZA()(),t.TgZ(35,"ion-item")(36,"ion-label",7),t._uU(37),t.ALo(38,"translate"),t.qZA(),t._UZ(39,"ion-textarea",16),t.ALo(40,"translate"),t.qZA()(),t.TgZ(41,"div",17)(42,"ion-button",18),t.NdJ("click",function(){return o.save()}),t._uU(43),t.ALo(44,"translate"),t.qZA()()()()),2&e&&(t.Q6J("translucent",!0),t.xp6(3),t.Q6J("routerLink","/swarms/view/"+o.swarmId),t.xp6(3),t.Oqu(t.lcZ(7,19,o.entryId?"JOURNAL_PAGE.editEntry":"JOURNAL_PAGE.newEntry")),t.xp6(3),t.Q6J("formGroup",o.entryForm),t.xp6(1),t.Q6J("inset",!0),t.xp6(3),t.Oqu(t.lcZ(14,21,"JOURNAL_PAGE.actionType")),t.xp6(2),t.Q6J("disabled",!!o.entryId)("okText",t.lcZ(17,23,"GENERAL.ok"))("cancelText",t.lcZ(18,25,"GENERAL.cancel")),t.xp6(4),t.Q6J("ngForOf",o.typeOptions),t.xp6(3),t.hij(" ",t.lcZ(23,27,"JOURNAL_PAGE.date")," "),t.xp6(3),t.Oqu(t.xi3(26,29,o.entryForm.controls.date.value,"dd.MM.yyyy")),t.xp6(4),t.Q6J("ngClass",t.VKq(40,Z,!o.countable)),t.xp6(2),t.hij(" ",t.lcZ(32,32,"JOURNAL_PAGE.amount")," "),t.xp6(2),t.Q6J("ngIf",o.countable),t.xp6(4),t.Oqu(t.lcZ(38,34,"JOURNAL_PAGE.comment")),t.xp6(2),t.s9C("placeholder",t.lcZ(40,36,"JOURNAL_PAGE.optionalComment")),t.xp6(3),t.Q6J("disabled",!o.entryForm.valid||o.saving),t.xp6(1),t.hij(" ",t.lcZ(44,38,"GENERAL.save")," "))},directives:[i.Gu,i.sr,i.Sm,i.YG,i.YI,c.rH,i.gu,i.wd,i.W2,r._Y,r.JL,r.sg,i.q_,i.Ie,i.Q$,i.t9,i.QI,r.JJ,r.u,u.sg,i.n0,i.pK,i.j9,i.d8,i.x4,u.mk,u.O5,i.g2],pipes:[d.X$,u.uU],styles:[""]}),n})()}];let _=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[c.Bz.forChild(T)],c.Bz]}),n})(),C=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[u.ez,r.u5,i.Pc,_,r.UX,d.aw]]}),n})()}}]);
//# sourceMappingURL=src_app_pages_swarms_swarm-journal_journal-edit-entry_journal-edit-entry_module_ts.47f4789bcf4bbbc6.js.map