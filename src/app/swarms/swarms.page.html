<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="end">
      <ion-menu-button menu="first"></ion-menu-button>
    </ion-buttons>
    <ion-title> {{ 'COLONIES_PAGE.pageTitle' | translate }} </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ng-container *ngIf="sortedSwarmGroups">
    <ion-list [inset]="true" lines="full">
      <ion-reorder-group
        *ngIf="sortedSwarmGroups.length > 0; else noBuzz"
        disabled="false"
        (ionItemReorder)="doReorder($event)"
      >
        <ng-container *ngFor="let group of sortedSwarmGroups; let idx = index">
          <ion-item-sliding [ngClass]="{'top-buffer': idx > 0}">
            <ion-item
              class="ion-text-center groupHeading"
              (click)="group.id && editSwarmGroup(group)"
            >
              <ion-label>
                <strong> {{ group.name }} </strong><br />
                <span
                  *ngIf="group.swarms.length === 0"
                  class="small-preview"
                  [innerHTML]="'COLONIES_PAGE.emptyGroupHint' | translate"
                >
                </span>
                <span
                  *ngIf="group.name === DEFAULT_GROUP_NAME && group.swarms.length > 0"
                  class="small-preview"
                >
                  {{"COLONIES_PAGE.changeGroupNameHint" | translate}}
                </span>
              </ion-label>
            </ion-item>
            <ion-item-options *ngIf="group.swarms.length === 0">
              <ion-item-option
                color="secondary"
                (click)="deleteGroup(group.id)"
              >
                <ion-icon slot="end" name="trash-outline"></ion-icon>
                {{"GENERAL.delete" | translate}}
              </ion-item-option>
            </ion-item-options>
          </ion-item-sliding>
          <ion-item
            *ngFor="let swarm of group.swarms"
            (tap)="openSwarmDetail(swarm.id)"
            (click)="openSwarmDetail(swarm.id)"
          >
            <ion-reorder slot="start"> üêù </ion-reorder>
            <ion-label>
              {{ swarm.name }}
              <span
                class="small-preview"
                *ngIf="swarm.lastAction as entry; else noActionYet"
              >
                <br />
                <strong>{{ entry.date | date:'dd. MMM'}}: </strong>
                {{ entry.type }}
              </span>
              <ng-template #noActionYet>
                <br />
                <span class="small-preview"
                  >{{"JOURNAL_PAGE.noTrackedActivity" | translate}}</span
                >
              </ng-template>
            </ion-label>
            <ion-label
              slot="end"
              [color]="swarm.statusInfo?.colonyStatus === 'VARROA_OK' ? 'success' : 
        (swarm.statusInfo?.colonyStatus === 'VARROA_MEDIUM' ? 'warning' : 'danger')"
              *ngIf="swarm.statusInfo?.colonyStatus"
              class="statusInfoLabel"
            >
              {{ swarm.statusInfo.avgCount }}
              <ion-icon name="bug-outline" slot="end"></ion-icon>
              <br />{{"COLONIES_PAGE.varroaCountUnit" | translate}}
            </ion-label>
          </ion-item>
        </ng-container>
      </ion-reorder-group>

      <ng-template #noBuzz>
        <ion-item class="ion-padding">
          {{ 'COLONIES_PAGE.noColonies' | translate }} üêù
        </ion-item>
      </ng-template>
    </ion-list>

    <ion-buttons class="ion-padding-horizontal">
      <ion-fab-button slot="end" color="primary" (click)="createSwarm()">
        <ion-icon name="add"></ion-icon>
      </ion-fab-button>
      <ion-fab-button slot="end" color="primary" (click)="editSwarmGroup()">
        <ion-icon name="duplicate-outline"></ion-icon>
      </ion-fab-button>
    </ion-buttons>
  </ng-container>
</ion-content>
